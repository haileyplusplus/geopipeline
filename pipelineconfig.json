{
  "name": "pipelineconfig",
  "description": "Configuration of pipeline workflows.",
  "stages": [
    {
      "name": "streets_fetch",
      "module": "catalogfetcher",
      "output_type": "geopandas.GeoDataFrame",
      "output_class": "PipelineFetcher",
      "parameters": {
        "datasource": {
          "domain": "chicago",
          "feed_id": "6imu-meau",
          "name": "Street Center Lines",
          "keep_cols": [
            "street_nam", "street_typ", "ewns_dir",
            "dir_travel", "status", "class", "length",
            "trans_id", "geometry"
          ]
        }
      }
    },
    {
      "name": "bike_routes_fetch",
      "module": "catalogfetcher",
      "output_type": "geopandas.GeoDataFrame",
      "output_class": "PipelineFetcher",
      "parameters": {
        "datasource": {
          "domain": "chicago",
          "feed_id": "3w5d-sru8",
          "name": "Bike Routes",
          "keep_cols": [
            "contraflow", "br_oneway", "displayrou", 
            "st_name", "geometry"
          ]
        }
      }
    },
   {
      "name": "community_areas_fetch",
      "module": "catalogfetcher",
      "output_type": "geopandas.GeoDataFrame",
      "output_class": "PipelineFetcher",
      "parameters": {
        "datasource": {
          "domain": "chicago",
          "feed_id": "cauq-8yn6",
          "name": "Boundaries - Community Areas (current)"
        }
      }
    },
   {
      "name": "business_fetch",
      "module": "catalogfetcher",
      "output_type": "geopandas.GeoDataFrame",
      "output_class": "PipelineFetcher",
      "parameters": {
        "datasource": {
          "domain": "chicago",
          "feed_id": "e4sp-itvq",
          "name": "Business Licenses - Current Active - Map.geojson"
        }
      }
    },
    {
      "name": "off_street_fetch",
      "module": "catalogfetcher",
      "output_type": "geopandas.GeoDataFrame",
      "output_class": "PipelineFetcher",
      "parameters": {
        "datasource": {
          "domain": "cookgis",
          "feed_id": "900b69139e874c8f823744d8fd5b71eb",
          "name": "Off-Street Bike Trails",
          "keep_cols": [
            "OBJECTID", "Street", "FacName", "Sub_System",
            "ShapeSTLength", "geometry"
          ],
          "filter": [
            {
              "column": "Muni",
              "value": "Chicago",
              "action": {
                "keep": {}
              }
            },
            {
              "column": "Status",
              "value": "Existing",
              "action": {
                "keep": {}
              }
            }
          ]
        }
      }
    },
    {
      "name": "streets_preprocess",
      "module": "map_processor",
      "output_type": "geopandas.GeoDataFrame",
      "output_class": "StreetsPreprocess"
    },
    {
      "name": "business_preprocess",
      "module": "bikenetwork",
      "output_type": "geopandas.GeoDataFrame",
      "output_class": "BusinessPreprocess"
    },
    {
      "name": "bike_routes_preprocess",
      "module": "map_processor",
      "output_type": "geopandas.GeoDataFrame",
      "output_class": "BikeRoutesPreprocess"
    },
    { "name": "off_street_preprocess",
      "module": "map_processor",
      "output_type": "geopandas.GeoDataFrame",
      "output_class": "OffStreetPreprocess"
    },
    {
      "name": "streets_bike_join",
      "module": "map_processor",
      "output_type": "geopandas.GeoDataFrame",
      "output_class": "StreetsBikeJoin"
    },
    {
      "name": "bikestreets_off_join",
      "module": "map_processor",
      "output_type": "geopandas.GeoDataFrame",
      "output_class": "BikeStreetsOffJoin"
    },
    {
      "name": "community_area_filter",
      "module": "cafilt",
      "output_type": "geopandas.GeoDataFrame",
      "output_class": "BoundaryFilter",
      "parameters": {
        "field": "community",
        "values": ["LINCOLN PARK", "LAKE VIEW", "NEAR NORTH SIDE",
                   "WEST TOWN", "LOGAN SQUARE"]
      }
    },
    {
      "name": "network_analyze",
      "module": "bikenetwork",
      "output_type": "geopandas.GeoDataFrame",
      "output_class": "NetworkStage",
      "parameters": {
        "sample_size": 300,
        "points_key": "license_id"
      }
    },
    {
      "name": "bikestreets_output",
      "module": "bikenetwork",
      "output_type": "geopandas.GeoDataFrame",
      "output_class": "ShapefileOutput"
    }
  ],
  "workflows": [
    {
      "name": "bikemap",
      "final": "bikestreets_output",
      "stages": [
        {
          "stage": "bikestreets_output",
          "dependencies": ["network_analyze"]
        },
        {
          "stage": "network_analyze",
          "dependencies": [
            "community_area_filter",
            "business_preprocess"
          ]
        },
        {
          "stage": "community_area_filter",
          "dependencies": [
            "bikestreets_off_join",
            "community_areas_fetch"
          ]
        },
        {
          "stage": "bikestreets_off_join",
          "dependencies": [
            "off_street_preprocess",
            "streets_bike_join"
          ]
        },
        {
          "stage": "off_street_preprocess",
          "dependencies": ["off_street_fetch"]
        },
        {
          "stage": "off_street_fetch",
          "dependencies": []
        },
        {
          "stage": "streets_bike_join",
          "dependencies": [
            "streets_preprocess",
            "bike_routes_preprocess"
          ]
        },
        {
          "stage": "streets_preprocess",
          "dependencies": ["streets_fetch"]
        },
        {
          "stage": "bike_routes_preprocess",
          "dependencies": ["bike_routes_fetch"]
        },
        {
          "stage": "business_preprocess",
          "dependencies": [
            "business_fetch",
            "community_area_filter"
          ]
        },
        {
          "stage": "streets_fetch",
          "dependencies": []
        },
        {
          "stage": "bike_routes_fetch",
          "dependencies": []
        },
        {
          "stage": "community_areas_fetch",
          "dependencies": []
        },
        {
          "stage": "business_fetch",
          "dependencies": []
        }
      ]
    }
  ]
}
